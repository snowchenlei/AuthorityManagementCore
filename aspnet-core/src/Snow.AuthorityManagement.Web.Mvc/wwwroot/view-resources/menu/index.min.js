function queryParams(n){return{pageSize:n.limit,pageIndex:n.offset/n.limit,sort:n.sort,order:n.order,name:$("#txt_search_name").val(),parentId:$("#parentId").val()}}(function(){function o(){var n=[];return n.push('<div class="btn-group" style="display: inline-block;" role="group" aria-label="...">'),isGranted("Pages.Administration.Menus.Edit")&&n.push('<button type = "button" class="btn btn-sm btn-warning edit" title="修改"><i class="far fa-edit"><\/i><\/button>'),isGranted("Pages.Administration.Menus.Delete")&&n.push('<button type="button" class="btn btn-sm btn-danger remove" title="删除"><i class="fas fa-trash"><\/i><\/button>'),n.push("<\/div>"),n.join("")}function s(n,t,i){return i.items}function h(n,t){var i=$.fn.zTree.getZTreeObj(t);i.expandAll(!0)}function c(n,t,i,r){r===0?$("#parentId").val(""):$("#parentId").val(i.id);refreshTable()}function f(t){return t.valid()?!0:(n.stop(),!1)}function e(n){var t=n.serializeFormToJson();return JSON.stringify({menu:t})}function l(){t=bootbox.dialog({title:title,message:'<p><i class="fa fa-spin fa-spinner"><\/i> 加载中... <\/p>',size:"large",buttons:{cancel:{label:"取消",className:"btn-danger"},confirm:{label:"提交",className:"btn-success",callback:function(r){var u,o;if(r)return(n=Ladda.create(r.target),n.start(),u=$("#modelForm"),!f(u))?!1:(o=e(u),$.ajax({type:"POST",url:i,contentType:"application/json",data:o,success:function(){n.stop();toastr.success("添加成功");refreshTable();t.modal("hide")},error:function(t){toastr.error(t.responseText);n.stop()}}),!1)}}}});t.init(function(){$.get("/Menu/Create",{parentId:$("#parentId").val()},function(i){t.find(".bootbox-body").html(i);t.find("input:not([type=hidden]):first").focus();n.stop()})})}function a(r,u){t=bootbox.dialog({title:r,message:'<p><i class="fa fa-spin fa-spinner"><\/i> 加载中... <\/p>',size:"large",buttons:{cancel:{label:"取消",className:"btn-danger"},confirm:{label:"提交",className:"btn-success",callback:function(r){var o,s;if(r)return(n=Ladda.create(r.target),n.start(),o=$("#modelForm"),!f(o))?!1:(s=e(o),$.ajax({type:"PUT",url:i+u,contentType:"application/json",data:s,success:function(){toastr.success("修改成功");n.stop();refreshTable();t.modal("hide")},error:function(t){toastr.error(t.responseText);n.stop()}}),!1)}}}});t.init(function(){$.get("/Menu/Edit",{menuId:u,parentId:$("#parentId").val()},function(i){t.find(".bootbox-body").html(i);t.find("input:not([type=hidden]):first").focus();n.stop()})})}var r,u,t,n,i;window.operateEvents={"click .edit":function(t,i,r){n=Ladda.create(t.target);n.start();t.preventDefault();a("修改菜单："+r.name,r.id)},"click .remove":function(t,r,u){n=Ladda.create(t.target);n.start();bootbox.confirm({size:"small",title:"删除菜单"+u.name,message:"你确定要删除"+u.name+"吗？",callback:function(t){t?$.ajax({type:"DELETE",url:i+u.id,success:function(){var t=$("#tb-body");t.bootstrapTable("remove",{field:"id",values:[u.id]});n.stop();toastr.success("删除成功")}}):n.stop()}})}};r=[{checkbox:!0},{title:"操作",formatter:o,events:operateEvents},{field:"id",title:"Id",visible:!1},{field:"name",title:"名称"},{field:"icon",title:"图标"},{field:"sort",title:"排序",sortable:!0}];u={view:{selectedMulti:!1},data:{simpleData:{enable:!0,idKey:"id",pIdKey:"parentID",rootPId:0},key:{title:"id",name:"name"}},"async":{enable:!0,url:"/api/menus?pageSize=1000&pageIndex=0",dataFilter:s,type:"get"},callback:{onAsyncSuccess:h,onClick:c}};$(function(){table.init(i,r);loadPanel();$.fn.zTree.init($("#navTree"),u);isGranted("Pages.Administration.Menus.Create")||$("#btnAdd").remove();$("#create").click(function(){n=Ladda.create(this);n.start();l("添加新菜单")})});i="/api/menus/"})();