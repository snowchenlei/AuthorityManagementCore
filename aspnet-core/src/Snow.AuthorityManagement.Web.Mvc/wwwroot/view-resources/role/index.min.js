function queryParams(n){return{pageSize:n.limit,pageIndex:n.offset/n.limit,sort:n.sort,order:n.order,displayName:$("#txt_search_display_name").val()}}var absoluteUrl;(function(){function e(){var n=[];return n.push('<div class="btn-group" style="display: inline-block;" role="group" aria-label="...">'),isGranted("Pages.Administration.Roles.Edit")&&n.push('<button type="button" class="btn btn-sm btn-warning edit" title="修改"><i class="far fa-edit"><\/i><\/button>'),isGranted("Pages.Administration.Roles.Delete")&&n.push('<button type="button" class="btn btn-sm btn-danger remove" title="删除"><i class="fas fa-trash"><\/i><\/button>'),n.push("<\/div>"),n.join("")}function o(r){n=bootbox.dialog({title:r,message:'<p><i class="fa fa-spin fa-spinner"><\/i> 加载中... <\/p>',size:"large",buttons:{cancel:{label:"取消",className:"btn-danger"},confirm:{label:"提交",className:"btn-success",callback:function(r){var e,o;if(r)return(t=Ladda.create(r.target),t.start(),e=$("#modelForm"),!u(e))?!1:(o=f(e),$.ajax({type:"POST",url:i,contentType:"application/json",data:o,success:function(){t.stop();toastr.success("添加成功");refreshTable();n.modal("hide")},error:function(n){toastr.error(n.responseText);t.stop()}}),!1)}}}});n.init(function(){$.get("/Role/Create/",function(t){n.find(".bootbox-body").html(t);n.find("input:not([type=hidden]):first").focus()})})}function s(r,e){n=bootbox.dialog({title:r,message:'<p><i class="fa fa-spin fa-spinner"><\/i> 加载中... <\/p>',size:"large",buttons:{cancel:{label:"取消",className:"btn-danger"},confirm:{label:"提交",className:"btn-success",callback:function(r){var o,s;if(r)return(t=Ladda.create(r.target),t.start(),o=$("#modelForm"),!u(o))?!1:(s=f(o),$.ajax({type:"PUT",url:i+e,contentType:"application/json",data:s,success:function(){t.stop();toastr.success("修改成功");refreshTable();n.modal("hide")},error:function(n){toastr.error(n.responseText);t.stop()}}),!1)}}}});n.init(function(){$.get("/Role/Edit/"+e,function(t){n.find(".bootbox-body").html(t);n.find("input:not([type=hidden]):first").focus()})})}function u(n){return n.valid()?!0:(t.stop(),!1)}function f(n){var t=n.serializeFormToJson(),i=h(),r={role:t,permissionNames:i};return JSON.stringify(r)}function h(){var n=[],u=$.fn.zTree.getZTreeObj("authTree"),i=u.getCheckedNodes(!0),t,r;for(n.splice(0,n.length),t=0;t<i.length;t++)r=i[t],n.push(r.name);return n}var r,n,t,i;window.operateEvents={"click .edit":function(n,t,i){n.preventDefault();s("修改角色："+i.name,i.id)},"click .remove":function(n,t,r){bootbox.confirm({size:"small",title:"删除角色"+r.name,message:"你确定要删除"+r.name+"吗？",callback:function(n){n&&$.ajax({type:"DELETE",url:i+r.id,success:function(){var n=$("#tb-body");n.bootstrapTable("remove",{field:"id",values:[r.id]});toastr.success("删除成功")}})}})}};r=[{checkbox:!0},{title:"操作",formatter:e,events:operateEvents},{field:"id",title:"Id",visible:!1},{field:"displayName",title:"名称"},{field:"sort",title:"排序",sortable:!0}];$(function(){isGranted("Pages.Administration.Roles.Create")||$("#btnAdd").remove();$("#create").click(function(){o("添加新角色")});table.init(i,r);loadPanel();setDate($("#txt_search_addTime"),!0,!0)});i="/api/roles/"})();